<style>@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;src:local('Open Sans Light'),local('OpenSans-Light'),url(https://fonts.gstatic.com/s/opensans/v16/mem5YaGs126MiZpBA-UN_r8OUuhs.ttf) format('truetype')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;src:local('Open Sans Regular'),local('OpenSans-Regular'),url(https://fonts.gstatic.com/s/opensans/v16/mem8YaGs126MiZpBA-UFVZ0e.ttf) format('truetype')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:600;src:local('Open Sans SemiBold'),local('OpenSans-SemiBold'),url(https://fonts.gstatic.com/s/opensans/v16/mem5YaGs126MiZpBA-UNirkOUuhs.ttf) format('truetype')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;src:local('Open Sans Bold'),local('OpenSans-Bold'),url(https://fonts.gstatic.com/s/opensans/v16/mem5YaGs126MiZpBA-UN7rgOUuhs.ttf) format('truetype')}</style><style>*,input,select{font-family:'Open Sans',sans-serif;font-weight:400}.featured{background:#c39;color:#fff;padding:6px 24px!important;position:relative;left:-12px!important;top:1px!important;border-radius:0!important;font-size:1.3em;font-weight:400}.mle_item{margin:3em 0 .5em;border-top:2px solid rgba(0,0,0,.1);padding:.5em 1em;font-size:95%}.mle_title{font-weight:400;font-size:1.85em;line-height:1em;margin:0;padding:1em 0 .4em;color:#1d1d1d}.mle_description{font-size:1.2em;line-height:2em;padding:0 0 1em;color:#343536;font-weight:400}.mle_button{border:solid 1px #609;background-color:#609;display:block;color:#fff;padding:5px;border-radius:4px;margin:1em 0;width:20%;text-align:center}.mle_category_button,.mle_clear_filters_button{background:#fff;display:inline-block;padding:5px 10px;margin-right:5px;border-radius:8px;margin-bottom:10px}.mle_clear_filters_button{color:#cc3900;border:1px solid #cc3900}.mle_category_button{border:1px solid #c39}.mle_category_button_inactive{color:#c39}.mle_category_button_active{background:#c39;color:#fff}.mle_format_button{background:#fff;display:inline-block;padding:5px 10px;margin-right:5px;border-radius:8px;margin-bottom:10px;border:1px solid #609}.mle_format_button_inactive{color:#609}.mle_format_button_active{background:#609;color:#fff}.disable-selection{-moz-user-select:none;-ms-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-webkit-touch-callout:none}.hand-cursor{cursor:pointer}.mle_description_large{float:left;width:80%}.mle_button_large{float:right;width:20%}.mle_button_large a{width:70%;margin:auto}</style><!-- ng-cloak style --><style>[ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak], .ng-cloak, .x-ng-cloak {
        display: none !important;
    }</style><!-- article used to respect global.css styling --><div class="mainContentContainer" ng-app="mleOnlineResources" ng-controller="mainController"><!-- Loading --><div ng-if="!loaded"><h3>Loading online resource information</h3></div><div ng-if="loaded" ng-cloak><!-- Format filter buttons --><div ng-if="formats.length > 1"><div class="mle_format_button disable-selection hand-cursor" ng-class="formatFilters.includes(format) ? 'mle_format_button_active' : 'mle_format_button_inactive'" ng-repeat="format in formats" ng-click="formatToggle(format)">{{format}}</div></div><!-- Category tag filter buttons --><div><div class="mle_category_button disable-selection hand-cursor" ng-class="categoryFilters.includes(tag) ? 'mle_category_button_active' : 'mle_category_button_inactive'" ng-repeat="tag in tags" ng-click="categoryToggle(tag)">{{tag}}</div></div><!-- Clear filters button --><div ng-if="formats.length < 1 && tags.length < 1" class="mle_clear_filters_button disable-selection hand-cursor" ng-click="clearFilters()">Clear filters</div><!-- Resources collection --><div ng-repeat="resource in resources"><!-- Individual Resource --><div class="mle_item" ng-if="filterCategories.length == 0 || shouldResourceBeDisplayed(resource)"><span ng-if="resource.featured" class="featured">Featured</span><h3 class="mle_title">{{resource.title}}</h3><div class="mle_description"><div ng-class="{'mle_description_large': width > 800}">{{resource.description}}</div><div ng-class="{'mle_button_large': width > 800}" ng-if="!isSoundCloudLink(resource.link)"><a style="color:#ffffff; text-decoration: none;" class="mle_button disable-selection hand-cursor" ng-click="launchResource(resource.link)"><span style="width:100%;">Launch</span> <img alt="" src="https://www.library.manchester.ac.uk/assets/images/local/bullet-more-white.png"></a></div><div ng-if="isSoundCloudLink(resource.link)"><iframe width="100%" height="200" scrolling="no" frameborder="no" allow="autoplay" ng-src="{{generateSoundCloudIframeUrl(resource.link)}}"></iframe></div><div style="clear: both;"></div></div></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.7.8/angular.min.js"></script><script>var defaultResources="%5B%7B%22featured%22%3Afalse%2C%22title%22%3A%22Introduction%20to%20Citation%20Analysis%22%2C%22description%22%3A%22You%27ve%20spent%20a%20lot%20of%20time%20on%20making%20sure%20your%20research%20is%20cutting%20edge%20and%20packed%20full%20of%20insight%20and%20new%20discoveries%3B%20now%20you%20want%20to%20get%20an%20impression%20of%20the%20influence%20it%27s%20having.%5CnThis%20online%20module%20provides%20an%20introduction%20to%20Citation%20Analysis.%20It%20starts%20by%20looking%20at%20what%20a%20citation%20is%2C%20and%20explains%20why%20it%27s%20not%20always%20true%20that%20the%20more%20citations%20a%20publication%20receives%2C%20the%20more%20influential%20it%20is.%5CnYou%u2019ll%20see%20how%20average%20levels%20of%20citation%20are%20different%20in%20different%20academic%20disciplines%2C%20and%20how%20percentiles%20can%20be%20used%20to%20assess%20the%20citation%20impact%20of%20a%20publication.%22%2C%22duration%22%3A%2230%20mins%22%2C%22format%22%3A%22Online%20tutorial%22%2C%22link%22%3A%22https%3A//www.escholar.manchester.ac.uk/learning-objects/mre/citation-analysis/%22%2C%22tags%22%3A%5B%5D%7D%2C%7B%22featured%22%3Afalse%2C%22title%22%3A%22Editing%20a%20journal%22%2C%22description%22%3A%22Being%20a%20journal%20editor%20can%20be%20hard%20work%2C%20enjoyable%2C%20frustrating%2C%20fascinating%2C%20aggravating%20and%20enlightening%20-%20frequently%20all%20at%20the%20same%20time.%5CnThis%20resource%20will%20give%20you%20an%20overview%20of%20the%20role%20of%20an%20editor.%20It%20will%20highlight%20the%20benefits%20of%20being%20an%20editor%2C%20how%20the%20role%20fits%20into%20the%20journal%20publishing%20process%2C%20and%20some%20of%20the%20challenges%20and%20decisions%20you%20will%20face%20in%20your%20work%20as%20an%20editor.%22%2C%22duration%22%3A%2230%20mins%22%2C%22format%22%3A%22Online%20tutorial%22%2C%22link%22%3A%22https%3A//www.escholar.manchester.ac.uk/learning-objects/mre/editing-articles/%22%2C%22tags%22%3A%5B%5D%7D%2C%7B%22featured%22%3Afalse%2C%22title%22%3A%22Peer%20review%22%2C%22description%22%3A%22Peer%20review%20is%20one%20of%20the%20cornerstones%20of%20scholarly%20publishing.%20It%20is%20a%20system%20for%20evaluating%20the%20quality%2C%20relevance%20and%20validity%20of%20research.%20Reviews%20should%20provide%20constructive%20criticism%20for%20authors%20to%20help%20them%20improve%20their%20work%2C%20as%20well%20as%20helping%20editors%20assess%20a%20paper%u2019s%20suitability%20for%20publication.%5CnThis%20resource%20will%20focus%20on%20peer%20review%20and%20journals%2C%20and%20will%20introduce%20you%20to%20the%20principles%20of%20peer%20review%20and%20different%20practices%20employed%20by%20journals.%20It%20will%20provide%20you%20with%20useful%20tips%20and%20guidance%20on%20how%20to%20write%20an%20effective%20review%20for%20both%20the%20author%20and%20the%20journal%20editor.%22%2C%22duration%22%3A%2230%20mins%22%2C%22format%22%3A%22Online%20tutorial%22%2C%22link%22%3A%22https%3A//www.escholar.manchester.ac.uk/learning-objects/mre/peer-review/%22%2C%22tags%22%3A%5B%5D%7D%2C%7B%22featured%22%3Afalse%2C%22title%22%3A%22Research%20Data%20Management%22%2C%22description%22%3A%22Research%20data%20management%20%28RDM%29%20is%20fundamental%20to%20all%20stages%20of%20the%20research%20process%20and%20should%20be%20established%20at%20the%20outset%20to%20safeguard%20good%20research%20practice.%5CnThis%20resource%20will%20explore%20the%20responsibilities%20of%20individual%20researchers%20and%20institutions%20in%20ensuring%20research%20data%20are%20managed%2C%20stored%20and%20shared%20appropriate%20and%20in%20accordance%20with%20University%20and%20funder%20policies%20and%20all%20relevant%20legal%2C%20ethical%20and%20other%20requirements.%22%2C%22duration%22%3A%2230%20mins%22%2C%22format%22%3A%22Online%20tutorial%22%2C%22link%22%3A%22https%3A//www.escholar.manchester.ac.uk/learning-objects/mre/research-data/%22%2C%22tags%22%3A%5B%5D%7D%2C%7B%22featured%22%3Afalse%2C%22title%22%3A%22How%20to%20get%20published%20in%20academic%20journals%22%2C%22description%22%3A%22There%20are%20many%20reasons%20to%20write%20up%20your%20research%20and%20disseminate%20it%20to%20the%20scholarly%20community%20and%20the%20wider%20public.%20This%20resource%20focuses%20on%20journal%20publications%2C%20providing%20tips%20on%20how%20to%20get%20your%20articles%20accepted%2C%20and%20highlighting%20what%20to%20expect%20during%20the%20editorial%20process.%22%2C%22duration%22%3A%2230%20mins%22%2C%22format%22%3A%22Online%20tutorial%22%2C%22link%22%3A%22https%3A//www.escholar.manchester.ac.uk/learning-objects/mre/getting-published/%22%2C%22tags%22%3A%5B%5D%7D%2C%7B%22featured%22%3Afalse%2C%22title%22%3A%22Research%20Data%20Explained%22%2C%22description%22%3A%22All%20research%20relies%20on%20data%20to%20support%20arguments%20and%20prove%20hypotheses%2C%20so%20managing%20your%20research%20data%20effectively%20is%20crucial.%5CnThis%20resource%20introduces%20you%20to%20what%20research%20data%20is%2C%20how%20it%20is%20defined%2C%20and%20how%20it%20differs%20from%20other%20types%20of%20information.%5Cn%A0After%20completion%20you%20will%3A%5Cn%5CnUnderstand%20the%20characteristics%20of%20data%20in%20various%20disciplines%5CnBe%20able%20to%20distinguish%20between%20different%20types%20of%20research%20data%5CnRecognise%20the%20importance%20of%20managing%20research%20data%22%2C%22duration%22%3A%2230%20minutes%22%2C%22format%22%3A%22Online%20tutorial%22%2C%22link%22%3A%22https%3A//www.escholar.manchester.ac.uk/learning-objects/mre/research-data-explained/%22%2C%22tags%22%3A%5B%5D%7D%2C%7B%22featured%22%3Afalse%2C%22title%22%3A%227%20Steps%20to%20maximise%20the%20profile%20of%20your%20next%20paper%22%2C%22description%22%3A%22Promotion%20of%20your%20papers%20and%20research%20is%20very%20important.%20Even%20the%20most%20valuable%20pieces%20of%20academic%20work%20can%20become%20lost%20in%20the%20vast%20number%20of%20papers%20that%20are%20published%20each%20year.%5CnThis%20resource%20will%20guide%20you%20through%207%20steps%20you%20can%20take%20to%20maximise%20the%20profile%20and%20reach%20of%20your%20work%20and%20ensure%20that%20it%20is%20credited%20to%20you%20correctly%22%2C%22duration%22%3A%2230%20minutes%22%2C%22format%22%3A%22Online%20tutorial%22%2C%22link%22%3A%22https%3A//www.escholar.manchester.ac.uk/learning-objects/mre/7-steps/%22%2C%22tags%22%3A%5B%5D%7D%2C%7B%22featured%22%3Afalse%2C%22title%22%3A%22testing%20this%20thing%22%2C%22description%22%3A%22Promotion%20of%20your%20papers%20and%20research%20is%20very%20important.%20Even%20the%20most%20valuable%20pieces%20of%20academic%20work%20can%20become%20lost%20in%20the%20vast%20number%20of%20papers%20that%20are%20published%20each%20year.%5CnThis%20resource%20will%20guide%20you%20through%207%20steps%20you%20can%20take%20to%20maximise%20the%20profile%20and%20reach%20of%20your%20work%20and%20ensure%20that%20it%20is%20credited%20to%20you%20correctly%22%2C%22duration%22%3A%2230%20minutes%22%2C%22format%22%3A%22Video%22%2C%22link%22%3A%22https%3A//www.escholar.manchester.ac.uk/learning-objects/mre/7-steps/%22%2C%22tags%22%3A%5B%22test%22%2C%22thing%22%5D%7D%5D";</script><script>var config={resourcesJsonUrl:"https://raw.githubusercontent.com/UoMLibrary/mre-online-resources/master/src/resources.json"};</script><script>var app = angular.module(
    'mleOnlineResources',
    []
);

app.config(
    function($locationProvider) {
        $locationProvider.html5Mode({enabled: true, requireBase: false});
    }
);

app.controller(
    'mainController',
    function($http, $scope, $window, $location, $sce) {

        var updateQuery = function() {
            $location.search({
                level2Links: $scope.categoryFilters.join(",")
            });
        };

        var getCurrentWidth = function() {
            return $window.innerWidth;
        };

        $scope.width =  getCurrentWidth();
        angular.element($window).bind('resize', function(){
            $scope.width = getCurrentWidth();
            $scope.$digest(); // manual $digest required as resize event is outside angular
        });


        $scope.loaded = false;

        const updateResources = function(resources) {

            // extract tags from resources
            var tagsSet = {};
            for(var i = 0; i < resources.length; i++) {
                var resource = resources[i];
                var tags = resource.tags;
                for(var j = 0; j < tags.length; j++) {
                    var tag = tags[j];
                    if(tag.includes(" - ")) {
                        tag = tag.split(" - ")[0];
                    }
                    if(!tagsSet[tag]) {
                        tagsSet[tag] = true;
                    }
                }
            }
            var tags = [];
            for(var tag in tagsSet) {
                tags.push(tag);
            }
            tags.sort();

            // extract format from resources
            var formatSet = {};
            for(var i = 0; i < resources.length; i++) {
                var resource = resources[i];
                var format = resource.format;
                if(!formatSet[format]) {
                    formatSet[format] = true;
                }
            }
            var formats = [];
            for(var format in formatSet) {
                formats.push(format);
            }
            formats.sort();

            // sort features (make featured resources at beginning of array)
            resources.sort(
                function(a, b) {
                    const aWeight = a.featured ? 0 : 1;
                    const bWeight = b.featured ? 0 : 1;
                    return aWeight - bWeight;
                }
            );

            $scope.resources = resources;
            $scope.tags = tags;
            $scope.formats = formats;

            $scope.loaded = true;

        };

        // Interpret query parameters
        var query = $location.search();
        if(query.level2Links) {
            var categoryFilters = query.level2Links.replace(/,$/, '').split(',');
            if(categoryFilters && categoryFilters.length > 0 && categoryFilters[0] !== '')
            {
                for(var i = 0; i < categoryFilters.length; i++) {
                    if(categoryFilters[i].includes(" - ")) {
                        categoryFilters[i] = categoryFilters[i].split(" - ")[0];
                    }
                }
                $scope.categoryFilters = categoryFilters;
            }
            // $scope.categoryFilters = query.level2Links.replace(/,$/, '').split(',');
        } else {
            $scope.categoryFilters = [];
        }

        // -- Handle resource input
        // Embedded static resources
        if(defaultResources) {
            console.log("using static resources");
            updateResources(JSON.parse(unescape(defaultResources)));
        }
        // External dynamic resources
        if(query.resourcesSource || config.resourcesJsonUrl) {

            var dynamicResourcesUrl;
            if(query.resourcesSource) {
                console.log("from query");
                dynamicResourcesUrl = decodeURI(query.resourcesSource);
            }
            else if(config.resourcesJsonUrl) {
                console.log("from config");
                dynamicResourcesUrl = config.resourcesJsonUrl;
            }

            console.log("using external resources: " + dynamicResourcesUrl);

            $http
                .get(dynamicResourcesUrl)
                .then(
                    function(response) {
                        updateResources(response.data)
                    }
                );
        }

        // Start of SoundCloud related code
        var extractApiTrackId = function (link) {
            if(link.startsWith("https://w.soundcloud.com/player/")) {
                trackIdMatches = link.match(/url\=(https%3A%2F%2Fapi\.soundcloud\.com%2Ftracks%2F=?)([\d]*)/)
                if(trackIdMatches.length > 1) { // found track ID
                    return trackIdMatches[2];
                } else {
                    return -1;
                }
            }
            else {
                return -1;
            }
        };
        $scope.isSoundCloudLink = function(link) {
            return extractApiTrackId(link) > 0;
        };

        $scope.generateSoundCloudIframeUrl = function(link) {
            return $sce.trustAsResourceUrl('https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/' + extractApiTrackId(link) + '&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true');
        };
        // End of SoundCloud related code


        $scope.launchResource = function(link) { //
            $window.open(link);
        };



        $scope.clearFilters = function() {
            $scope.formatFilters = [];
            $scope.categoryFilters = [];
            updateQuery();
        };

        $scope.formatFilters = [];
        var removeFormatFilter = function(format) {
            var found = $scope.formatFilters.indexOf(format);

            while (found !== -1) {
                $scope.formatFilters.splice(found, 1);
                found = $scope.formatFilters.indexOf(format);
            }
        };
        $scope.formatToggle = function(format) {
            if($scope.formatFilters.includes(format)) {
                removeFormatFilter(format);
            } else {
                $scope.formatFilters.push(format);
            }
        };

        if(!$scope.categoryFilters) $scope.categoryFilters = [];
        var removeCategoryFilter = function(category) {
            var found = $scope.categoryFilters.indexOf(category);

            while (found !== -1) {
                $scope.categoryFilters.splice(found, 1);
                found = $scope.categoryFilters.indexOf(category);
            }
            updateQuery();
        };

        $scope.categoryToggle = function(tag) {
            if($scope.categoryFilters.includes(tag)) {
                removeCategoryFilter(tag);
            } else {
                $scope.categoryFilters.push(tag);
            }
            updateQuery();
        };

        $scope.shouldResourceBeDisplayed = function(resource) {

            var category = false;
            if($scope.categoryFilters.length > 0) {
                for(var tag in resource.tags) {
                    if($scope.categoryFilters.includes(resource.tags[tag])) {
                        category = true;
                    }
                }
            } else {
                category = true;
            }

            var format = false;
            if($scope.formatFilters.length > 0) {
                if($scope.formatFilters.includes(resource.format)) {
                    format = true;
                }
            } else {
                format = true;
            }

            return category && format;

        }

    }
);</script>